<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <title>Tone generator</title>

        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>

        <script type="text/javascript">
            var sampleRate = 44100;
            var portionSize = sampleRate / 10;
            var prebufferSize = sampleRate / 2;
            var play = false;
            var writeInterval = Math.floor(1000 * portionSize / sampleRate);

            var audio = new Audio();
            audio.mozSetup(1, sampleRate, 1);
            var currentWritePosition = 0;

            function getSoundData(t, size) {
                var soundData = new Float32Array(size);
                var freq = parseFloat(document.getElementById("freq").value);
                if (freq) {
                    var k = 2* Math.PI * freq / sampleRate;
                    for (var i=0; i<size; i++) {
                        soundData[i] = Math.sin(k * (i + t));
                    }
                }
                return soundData;
            }

            function writeData() {
                while(audio.mozCurrentSampleOffset() + prebufferSize >= currentWritePosition) {
                    var soundData = getSoundData(currentWritePosition, portionSize);
                    audio.mozWriteAudio(soundData);
                    currentWritePosition += portionSize;
                }
                if (play) {
                    setTimeout(writeData, writeInterval);
                }
            }

            function start() {
                play = true;
                setTimeout(writeData, writeInterval);
            }

            function stop() {
                play = false;
            }

        </script>
    </head>

    <body>

        <input type="text" size="4" id="freq" value="440"><label for="hz">Hz</label>
        <button onclick="start()">play</button>
        <button onclick="stop()">stop</button>

    </body>
</html>
